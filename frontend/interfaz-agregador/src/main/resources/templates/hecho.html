<th:block th:fragment="pageScripts">
    <script th:inline="javascript">
        const hecho = /*[[${hecho}]]*/ '';
        const hechoId = /*[[${hecho.id}]]*/ '';
    </script>
    <script th:if="${isAdmin}" src="/js/etiqueta.js"></script>
    <script src="/js/solicitar-eliminacion.js"></script>
    <script th:if="${hecho.autor != null and hecho.autor.id == userId}" src="/js/editar-hecho.js"></script>
</th:block>

<th:block th:fragment="pageStyles">
    <link rel="stylesheet" type="text/css" th:href="@{/css/hecho.css}" />
</th:block>



<th:block th:replace="~{fragments/layout :: layout(~{::main}, false)}">
    <main class="main-padding flex flex-col items-center gap-[3.5rem]">
        <div class="info-container-hecho primary-info-container-hecho" th:object="${hecho}">
            <div class="flex justify-center">
                <h1 class="text-center fw-bold mb-4 text-3xl" th:text="*{titulo}">
                    Título
                </h1>
            </div>
            <div class="hecho-components">
                <div class="hecho-left-section">
                    <div id="carousel-hecho" class="carousel slide carousel-container" th:if="*{contenidoMultimedia != null and !contenidoMultimedia.isEmpty()}">
                        <div class="carousel-inner">
                            <div th:each="multimedia, iterStat : *{contenidoMultimedia}" th:class="${iterStat.first} ? 'carousel-item active' : 'carousel-item'">
                                <img th:src="${multimedia.url}" th:alt="${multimedia.tipo}" aria-label="Multimedia" class="d-block">
                            </div>
                        </div>
                        <button th:unless="*{#lists.size(contenidoMultimedia) == 1}" class="carousel-control-prev" type="button" aria-label="Anterior multimedia" data-bs-target="#carousel-hecho" data-bs-slide="prev">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="carousel-arrow">
                                <path stroke-linecap="round" stroke-linejoin="round" d="m11.25 9-3 3m0 0 3 3m-3-3h7.5M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z" />
                            </svg>
                        </button>
                        <button th:unless="*{#lists.size(contenidoMultimedia) == 1}" class="carousel-control-next" type="button" aria-label="Siguiente multimedia" data-bs-target="#carousel-hecho" data-bs-slide="next">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="carousel-arrow">
                                <path stroke-linecap="round" stroke-linejoin="round" d="m12.75 15 3-3m0 0-3-3m3 3h-7.5M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z" />
                            </svg>
                        </button>
                    </div>
                    <div class="carousel-container" th:if="*{contenidoMultimedia == null or contenidoMultimedia.isEmpty()}">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="h-[100px] w-[100px] text-[#9ca3af]">
                            <path stroke-linecap="round" stroke-linejoin="round" d="m2.25 15.75 5.159-5.159a2.25 2.25 0 0 1 3.182 0l5.159 5.159m-1.5-1.5 1.409-1.409a2.25 2.25 0 0 1 3.182 0l2.909 2.909m-18 3.75h16.5a1.5 1.5 0 0 0 1.5-1.5V6a1.5 1.5 0 0 0-1.5-1.5H3.75A1.5 1.5 0 0 0 2.25 6v12a1.5 1.5 0 0 0 1.5 1.5Zm10.5-11.25h.008v.008h-.008V8.25Zm.375 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Z" />
                        </svg>
                    </div>
                    <div th:if="${isLoggedIn}">
                        <div class="relative flex items-center gap-4">
                            <button id="solicitar-eliminacion" class="btn-solicitar">
                                Solicitar eliminación
                            </button>
                            <th:block th:replace="~{fragments/modal :: modalSolicitudEliminacion}" />
                            <th:block th:if="${!hecho.anonimato and hecho.autor != null and hecho.autor.id == userId}">
                                <th:block th:if="${puedeEditarHecho}">
                                    <th:block th:replace="~{fragments/form :: spinnerButton('Editar Hecho', 'hecho-editar', null)}" />
                                </th:block>
                                <th:block th:unless="${puedeEditarHecho}">
                                    <button id="hecho-editar" class="btn-primary opacity-50 cursor-not-allowed" disabled>
                                        Editar Hecho
                                    </button>
                                </th:block>
                            </th:block>
                        </div>
                        <div th:if="${!hecho.anonimato and hecho.autor != null and hecho.autor.id == userId and diasRestantesEdicion != null}"
                             class="text-sm mt-2">
                            <span th:if="${diasRestantesEdicion > 0}" class="text-gray-600">
                                Te quedan <strong th:text="${diasRestantesEdicion}">X</strong>
                                <span th:text="${diasRestantesEdicion == 1 ? 'día' : 'días'}">días</span> para editar este hecho
                            </span>
                            <span th:unless="${diasRestantesEdicion > 0}" class="text-red-600">
                                El plazo de edición expiró
                            </span>
                        </div>
                    </div>
                </div>
                <div class="right-section-hecho">
                    <div class="info-item-hecho">
                        <p class="info-label-hecho">
                            Descripción
                        </p>
                        <p class="text-left" th:text="*{descripcion}">
                            Descripción
                        </p>
                    </div>
                    <div class="info-item-hecho">
                        <p class="info-label-hecho">
                            Categoría
                        </p>
                        <p class="text-left" th:text="*{categoria.nombre}">
                            Categoría
                        </p>
                    </div>
                    <div class="info-item-hecho" >
                        <div class="info-label-hecho flex gap-2 items-center">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-[1.25rem] h-[1.25rem]">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M15 10.5a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z" />
                                <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 10.5c0 7.142-7.5 11.25-7.5 11.25S4.5 17.642 4.5 10.5a7.5 7.5 0 1 1 15 0Z" />
                            </svg>
                            Ubicación
                        </div>
                        <p class="text-left" th:text="*{direccion != null ? direccion : 'Sin ubicación'}">
                            Dirección completa
                        </p>
                    </div>
                    <div class="info-item-hecho" th:if="*{etiquetas != null && !etiquetas.isEmpty()}">
                        <div class="info-label-hecho flex gap-2 items-center">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-[1.25rem] h-[1.25rem]">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M9.568 3H5.25A2.25 2.25 0 0 0 3 5.25v4.318c0 .597.237 1.17.659 1.591l9.581 9.581c.699.699 1.78.872 2.607.33a18.095 18.095 0 0 0 5.223-5.223c.542-.827.369-1.908-.33-2.607L11.16 3.66A2.25 2.25 0 0 0 9.568 3Z" />
                                <path stroke-linecap="round" stroke-linejoin="round" d="M6 6h.008v.008H6V6Z" />
                            </svg>
                            Etiquetas
                        </div>
                        <div th:if="${isAdmin}">
                            <ul id="lista-etiquetas" class="tag-list">
                                <li th:each="etiqueta : *{etiquetas}" th:data-nombre="${etiqueta.nombre}" class="tag-item">
                                    <span th:text="${etiqueta.nombre}"></span>
                                    <button th:id="|eliminar-etiqueta-${etiqueta.nombre}|" type="button" th:data-nombre="${etiqueta.nombre}" class="btn-eliminar-etiqueta flex justify-center" aria-label="Eliminar Etiqueta">
                                        <span th:id="|nombre-btn-eliminar-${etiqueta.nombre}|">
                                            X
                                        </span>
                                        <div th:id="|spinner-btn-eliminar-${etiqueta.nombre}|" class="hidden border-2 border-white border-t-transparent rounded-full animate-spin w-[0.75rem] h-[0.75rem]"></div>
                                    </button>
                                </li>
                            </ul>
                            <div class="agregar-tag gap-3">
                                <input id="nueva-etiqueta" type="text" maxlength="20" placeholder="Agregar nueva etiqueta" class="input-tag max-w-[250px] w-auto" aria-label="Agregar Nueva Etiqueta"/>
                                <th:block th:replace="~{fragments/form :: spinnerButton('Agregar', 'btn-agregar-etiqueta', 'btn-tertiary')}" />
                            </div>
                        </div>
                        <div class="lista-etiquetas" th:if="${!isAdmin}">
                            <span th:each="etiqueta : *{etiquetas}">
                                <span class="tag-item" th:text="${etiqueta.nombre}"></span>
                            </span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="info-container-hecho flex">
            <div class="secondary-info-container-hecho">
                <h2 class="info-label-hecho">
                    Contenido Texto
                </h2>
                <p class="text-left" th:if="${hecho.contenidoTexto != null and !hecho.contenidoTexto.isEmpty()}" th:text="${hecho.contenidoTexto}">
                    Aquí va el contenido de texto del hecho...
                </p>
                <p th:unless="${hecho.contenidoTexto != null and !hecho.contenidoTexto.isEmpty()}" class="contenido-vacio">
                    No hay contenido de texto en este hecho!
                </p>
            </div>
            <div class="tertiary-info-container-hecho">
                <div class="flex justify-around">
                    <div class="flex flex-col">
                        <div class="info-item-hecho items-center">
                            <p class="info-label-hecho">
                                Autor
                            </p>
                            <p th:text="${hecho.autor != null ? hecho.autor.identidad.nombre + ' '  + hecho.autor.identidad.apellido : 'Anónimo'}">
                                Anónimo
                            </p>
                        </div>
                        <div class="info-item-hecho items-center">
                            <p class="info-label-hecho">
                                Origen
                            </p>
                            <p th:text="${hecho.origen}"></p>
                        </div>
                    </div>
                    <div class="flex flex-col">
                        <div class="info-item-hecho items-center">
                            <p class="info-label-hecho">
                                Fecha de acontecimiento
                            </p>
                            <p th:text="*{#temporals.format(hecho.fechaAcontecimiento, 'dd/MM/yyyy HH:mm')}">
                                01/01/2024 12:00
                            </p>
                        </div>
                        <div class="info-item-hecho items-center">
                            <p class="info-label-hecho">
                                Fecha de carga
                            </p>
                            <p th:text="${#temporals.format(hecho.fechaCarga, 'dd/MM/yyyy HH:mm')}">
                                01/01/2024 12:00
                            </p>
                        </div>
                    </div>
                </div>
                <div class="ultima-modificacion-hecho" th:if="${hecho.fechaUltimaModificacion != hecho.fechaCarga}">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-[20px] h-[20px]">
                        <path stroke-linecap="round" stroke-linejoin="round" d="m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L10.582 16.07a4.5 4.5 0 0 1-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 0 1 1.13-1.897l8.932-8.931Zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0 1 15.75 21H5.25A2.25 2.25 0 0 1 3 18.75V8.25A2.25 2.25 0 0 1 5.25 6H10" />
                    </svg>
                    <span>
                        Editado por última vez:
                        <span class="text-black" th:text="${#temporals.format(hecho.fechaUltimaModificacion, 'dd/MM/yyyy HH:mm')}">
                            01/01/2024 12:00
                        </span>
                    </span>
                </div>
            </div>
        </div>
    </main>
</th:block>