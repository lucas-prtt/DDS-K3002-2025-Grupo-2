<div th:fragment="modalHecho" id="modal-hecho" class="modal-page hidden">
	<!-- Modal personalizado -->
	<div class="modal-content modal-page-format max-w-2xl">
		<div class="create-modal-header">
			<h5 id="modal-crear-hecho-titulo" class="modal-title hidden">
				Crear Nuevo Hecho
			</h5>
			<h5 id="modal-editar-hecho-titulo" class="modal-title hidden">
				Editar Hecho
			</h5>
		</div>

		<div class="modal-page-body">
			<form id="form-crear-hecho">
				<!-- Fila 1: Título y Categoría -->
				<div class="row g-2 mb-3">
					<div class="col-md-8">
						<label for="crear-hecho-titulo" class="form-label">
							Título
							<span class="text-red-500">
								*
							</span>
							<span class="max-char-span">
								(Máx.200 caracteres)
							</span>
						</label>
						<input type="text" maxlength="200" class="form-control" id="crear-hecho-titulo" placeholder="Ingrese el título del hecho" required>
					</div>
					<div class="col-md-4">
						<label for="crear-hecho-categoria" class="form-label">
							Categoría
							<span class="text-red-500">
								*
							</span>
						</label>
						<input type="text" class="form-control" maxlength="50" id="crear-hecho-categoria" placeholder="Ej: Desastre Natural" required>
					</div>
				</div>

				<!-- Fila 2: Descripción -->
				<div class="mb-3">
					<label for="crear-hecho-descripcion" class="form-label">
						Descripción
						<span class="text-red-500">
							*
						</span>
						<span class="max-char-span">
							(Máx.1000 caracteres)
						</span>
					</label>
					<textarea class="form-control" maxlength="1000" id="crear-hecho-descripcion" rows="2" placeholder="Ingrese la descripción del hecho" required></textarea>
				</div>

				<!-- Sección de Ubicación -->
				<div class="mb-3">
					<label class="form-label">
						Ubicación
					</label>
					<div class="mb-2 d-flex items-center">
						<input type="checkbox" id="crear-hecho-usar-coordenadas" class="form-check-input m-0" aria-label="Usar Coordenadas">
						<p class="ms-2 text-black">
							Ingresar manualmente latitud y longitud
						</p>
					</div>

					<!-- Campos de dirección -->
					<div id="direccion-container" class="row g-2">
						<div class="col-md-6">
							<label for="crear-hecho-pais" class="form-label">País<span class="text-red-500">*</span></label>
							<input type="text" class="form-control" id="crear-hecho-pais" placeholder="Ej: Argentina" required>
						</div>
						<div class="col-md-6">
							<label for="crear-hecho-provincia" class="form-label">Provincia<span class="text-red-500">*</span></label>
							<input type="text" class="form-control" id="crear-hecho-provincia" placeholder="Ej: Buenos Aires" required>
						</div>
						<div class="col-md-4">
							<label for="crear-hecho-ciudad" class="form-label">Ciudad<span class="text-red-500">*</span></label>
							<input type="text" class="form-control" id="crear-hecho-ciudad" placeholder="Ej: La Plata" required>
						</div>
						<div class="col-md-5">
							<label for="crear-hecho-calle" class="form-label">Calle<span class="text-red-500">*</span></label>
							<input type="text" class="form-control" id="crear-hecho-calle" placeholder="Ej: Calle 7" required>
						</div>
						<div class="col-md-3">
							<label for="crear-hecho-altura" class="form-label">Altura<span class="text-red-500">*</span></label>
							<input type="text" class="form-control" id="crear-hecho-altura" placeholder="Ej: 1234" required>
						</div>
					</div>

					<!-- Campos de coordenadas -->
					<div id="crear-hecho-coordenadas-container" class="row g-2 hidden">
						<div class="col-md-6">
							<label for="crear-hecho-latitud" class="form-label">Latitud<span class="text-red-500">*</span></label>
							<input type="number" step="any" class="form-control" id="crear-hecho-latitud" placeholder="-34.603722">
						</div>
						<div class="col-md-6">
							<label for="crear-hecho-longitud" class="form-label">Longitud<span class="text-red-500">*</span></label>
							<input type="number" step="any" class="form-control" id="crear-hecho-longitud" placeholder="-58.381592">
						</div>
					</div>
				</div>

				<!-- Fila 3: Fecha y Contenido Texto -->
				<div class="row g-2 mb-3">
					<div class="col-md-5">
						<label for="crear-hecho-fecha" class="form-label">
							Fecha y Hora
							<span class="text-red-500">
								*
							</span>
						</label>
						<input id="crear-hecho-fecha" type="datetime-local" class="form-control" required>
					</div>
					<div class="col-md-7">
						<label for="crear-hecho-contenido-texto" class="form-label">
							Contenido de Texto
							<span class="text-red-500">
								*
							</span>
							<span class="max-char-span">
								(Máx.500 caracteres)
							</span>
						</label>
						<textarea id="crear-hecho-contenido-texto" class="form-control" maxlength="500" rows="2" placeholder="Describa el hecho..." required></textarea>
					</div>
				</div>

				<!-- Sección de Multimedia -->
				<div class="mb-3">
					<label class="form-label">
						Contenido Multimedia
						<span class="max-char-span">
								(Máx.500 caracteres)
						</span>
					</label>
					<div id="crear-hecho-multimedia-container"></div>
					<button id="crear-hecho-agregar-multimedia" type="button" class="btn-tertiary">
						+ Añadir Multimedia
					</button>
				</div>

				<!-- Checkbox de anonimato -->
				<div class="mb-3 d-flex items-center">
					<input type="checkbox" id="crear-hecho-anonimato" class="form-check-input m-0" aria-label="Declararse Anónimo">
					<p class="ms-2 text-black">
						Publicar de forma anónima
					</p>
				</div>
			</form>
		</div>

		<div class="modal-footer">
			<div th:replace="~{fragments/button :: exitModalButton('Cancelar', 'salir-crear-hecho')}" class="hidden"></div>
			<div th:replace="~{fragments/button :: spinnerConfirmButton('Publicar', 'crear-hecho')}" class="hidden"></div>
			<div th:replace="~{fragments/button :: exitModalButton('Volver', 'salir-editar-hecho')}" class="hidden"></div>
			<div th:replace="~{fragments/button :: spinnerConfirmButton('Guardar Cambios', 'editar-hecho')}" class="hidden"></div>
		</div>
	</div>
</div>

<div th:fragment="modalCrearColeccion" id="modal-crear-coleccion" class="modal-page hidden">
	<!-- Modal para Crear Colección -->
	<div class="modal-content modal-page-format max-w-2xl">
		<!-- Header del Modal -->
		<div class="create-modal-header">
			<h5 class="modal-title text-white">Crear Nueva Colección</h5>
		</div>

		<!-- Body del Modal (con scroll) -->
		<div class="modal-page-body">
			<form id="form-crear-coleccion" class="space-y-4">
				<!-- Título -->
				<div>
					<label for="titulo-coleccion" class="block text-sm font-medium text-gray-700 mb-1">
						Título
						<span class="max-char-span">
							(Máx.50 caracteres)
						</span>
					</label>
					<input type="text" id="titulo-coleccion" maxlength="50"
						   class="form-control"
						   placeholder="Ingrese el título de la colección" required>
				</div>

				<!-- Descripción -->
				<div>
					<label for="descripcion-coleccion" class="block text-sm font-medium text-gray-700 mb-1">
						Descripción
						<span class="max-char-span">
							(Máx.150 caracteres)
						</span>
					</label>
					<textarea id="descripcion-coleccion" rows="3" maxlength="150"
							  class="form-control"
							  placeholder="Describa la colección" required></textarea>
				</div>

				<!-- Criterio de Pertenencia -->
				<div>
					<label for="criterio-tipo" class="block text-sm font-medium text-gray-700 mb-1">Criterio de
						Pertenencia
					</label>
					<select id="criterio-tipo"
							class="form-control">
						<option value="">Seleccione un criterio</option>
						<option value="DISTANCIA">Distancia</option>
						<option value="FECHA">Fecha</option>
					</select>
				</div>

				<!-- Campos Distancia -->
				<div id="campos-distancia" class="space-y-2 hidden">
					<div class="grid grid-cols-2 gap-2">
						<div>
							<label for="criterio-latitud" class="block text-sm font-medium text-gray-700 mb-1">
								Latitud Base
							</label>
							<input type="number" step="any" id="criterio-latitud"
								   class="form-control"
								   placeholder="-34.603722">
						</div>
						<div>
							<label for="criterio-longitud" class="block text-sm font-medium text-gray-700 mb-1">
								Longitud Base
							</label>
							<input type="number" step="any" id="criterio-longitud"
								   class="form-control"
								   placeholder="-58.381592">
						</div>
					</div>
					<div>
						<label for="criterio-distancia-minima" class="block text-sm font-medium text-gray-700 mb-1">
							Distancia Mínima (km)
						</label>
						<input type="number" step="any" id="criterio-distancia-minima"
							   class="form-control"
							   placeholder="100">
					</div>
				</div>

				<!-- Campos Fecha -->
				<div id="campos-fecha" class="space-y-2 hidden">
					<div>
						<label for="criterio-fecha-inicial" class="block text-sm font-medium text-gray-700 mb-1">
							Fecha Inicial
						</label>
						<input type="datetime-local" id="criterio-fecha-inicial"
							   class="form-control">
					</div>
					<div>
						<label for="criterio-fecha-final" class="block text-sm font-medium text-gray-700 mb-1">
							Fecha Final
						</label>
						<input type="datetime-local" id="criterio-fecha-final"
							   class="form-control">
					</div>
				</div>

				<!-- Fuentes -->
				<div>
					<label class="block text-sm font-medium text-gray-700 mb-1">Fuentes</label>
					<div id="fuentes-container" class="space-y-2"></div>
					<button id="crear-coleccion-agregar-fuente" type="button" class="btn-tertiary">
						+ Agregar Fuente
					</button>
				</div>

				<!-- Algoritmo de Consenso -->
				<div>
					<label for="algoritmo-consenso" class="block text-sm font-medium text-gray-700 mb-1">
						Algoritmo de Consenso
					</label>
					<select id="algoritmo-consenso"
							class="form-control">
						<option value="">Seleccione un algoritmo</option>
						<option value="ABSOLUTO">Absoluto</option>
						<option value="IRRESTRICTO">Irrestricto</option>
						<option value="MAYORIA_SIMPLE">Mayoría simple</option>
						<option value="MULTIPLES_MENCIONES">Múltiples menciones</option>
					</select>
				</div>
			</form>
		</div>

		<!-- Footer del Modal -->
		<div class="modal-footer flex justify-end gap-2 p-4 border-t">
			<th:block th:replace="~{fragments/button :: exitModalButton('Cancelar', 'salir-crear-coleccion')}" />
			<th:block th:replace="~{fragments/button :: spinnerConfirmButton('Crear Colección', 'crear-coleccion')}" />
		</div>
	</div>
</div>

<div th:fragment="modalMisHechos" id="modal-mis-hechos" class="modal-page hidden">
	<div class="modal-content modal-page-format max-w-lg min-w-[200px] min-h-[200px]">
		<div class="modal-header">
			<h5 class="modal-title">Mis Hechos</h5>
		</div>
		<div class="modal-page-body">
			<div id="lista-mis-hechos" class="list-group"></div>
		</div>
		<div class="modal-footer">
			<th:block th:replace="~{fragments/button :: exitModalButton('Cerrar', 'salir-mis-hechos')}" />
		</div>
	</div>
</div>

<div th:fragment="modalEditarPerfil" id="modal-editar-perfil" class="modal-page hidden">
	<div class="modal-content modal-page-format max-w-lg">

		<div class="modal-header">
			<h5 class="modal-title text-white">Editar Perfil</h5>
		</div>

		<div class="modal-page-body">
			<form id="formEditarPerfil" class="space-y-4">
				<div>
					<label for="perfil-nombre" class="form-label">
						Nombre
						<span class="text-red-500">
							*
						</span>
						<span class="max-char-span">
							(Máx.20 caracteres)
						</span>
					</label>
					<input type="text" id="perfil-nombre" maxlength="20"
						   class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-gray-300" required>
				</div>

				<div>
					<label for="perfil-apellido" class="form-label">
						Apellido
						<span class="text-red-500">
							*
						</span>
						<span class="max-char-span">
							(Máx.20 caracteres)
						</span>
					</label>
					<input type="text" id="perfil-apellido" maxlength="20"
						   class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-gray-300" required>
				</div>

				<div>
					<label for="perfil-email" class="form-label">
						Email
						<span class="max-char-span">
							(Máx.255 caracteres)
						</span>
					</label>
					<input type="email" id="perfil-email" maxlength="255"
						   class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-gray-300" required>
				</div>

				<div>
					<label for="perfil-fecha-nacimiento" class="form-label">
						Fecha de Nacimiento
					</label>
					<input type="date" id="perfil-fecha-nacimiento"
						   class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-gray-300" required>
				</div>
			</form>
		</div>

		<div class="modal-footer flex justify-end items-center p-4 border-t border-gray-200 space-x-3">
			<th:block th:replace="~{fragments/button :: exitModalButton('Cancelar', 'salir-editar-perfil')}" />
			<th:block th:replace="~{fragments/button :: spinnerConfirmButton('Guardar Cambios', 'editar-perfil')}" />
		</div>
	</div>
</div>

<!-- Fragmento hechosRecientes -->
<div th:fragment="modalHechosRecientes(hechos)" id="hechos-recientes-modal" class="panel">
	<div class="flex justify-between items-center p-4 pb-3">
		<h3 class="text-xl font-bold">Hechos Recientes</h3>
		<button id="btn-toggle-hechos"
				class="text-gray-600 hover:text-gray-900 focus:outline-none transition-transform duration-200">
			<svg id="chevron-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2"
				 stroke="currentColor" class="w-6 h-6">
				<path stroke-linecap="round" stroke-linejoin="round" d="M19.5 8.25l-7.5 7.5-7.5-7.5"/>
			</svg>
		</button>
	</div>
	<hr id="hechos-separator" class="mb-4">

	<div id="hechos-content" class="px-4 pb-4 max-h-96 overflow-y-auto">
		<div class="space-y-2">
			<!-- Reducción de padding (p-2), font-size (text-xs) y margin (mb-0.5) -->
			<a th:each="hecho : ${hechos}"
			   th:href="@{/hechos/{id}(id=${hecho.id})}"
			   class="block p-2 hover:bg-gray-50 rounded-lg transition-colors border-b last:border-b-0">
				<div class="flex justify-between items-start">
					<div class="flex-1 min-w-0">
						<h5 class="font-medium text-gray-900 mb-0.5 truncate" th:text="${hecho.titulo}">Título del
							hecho</h5>
						<p class="text-xs text-gray-600 truncate"
						   th:text="${hecho.direccion != null ? hecho.direccion : 'Sin ubicación'}">
							Dirección del hecho
						</p>
					</div>
					<div class="text-right ml-3 flex-shrink-0">
						<!-- Tamaño de fuente reducido a text-xs -->
						<small class="text-xs text-gray-500 whitespace-nowrap">
                                <span th:if="${hecho.fechaCarga != null}"
									  th:with="ahora=${T(java.time.LocalDateTime).now()}, duracion=${T(java.time.Duration).between(hecho.fechaCarga, ahora)}">
                                    <span th:if="${duracion.toDays() > 0}"
										  th:text="${'Hace ' + duracion.toDays() + (duracion.toDays() == 1 ? ' día' : ' días')}"></span>
                                    <span th:if="${duracion.toDays() == 0 && duracion.toHours() > 0}"
										  th:text="${'Hace ' + duracion.toHours() + (duracion.toHours() == 1 ? ' hora' : ' horas')}"></span>
                                    <span th:if="${duracion.toDays() == 0 && duracion.toHours() == 0 && duracion.toMinutes() > 0}"
										  th:text="${'Hace ' + duracion.toMinutes() + ' min'}"></span>
                                    <span th:if="${duracion.toDays() == 0 && duracion.toHours() == 0 && duracion.toMinutes() == 0}">Hace un momento</span>
                                </span>
							<span th:unless="${hecho.fechaCarga != null}">Fecha N/A</span>
						</small>
					</div>
				</div>
			</a>
		</div>

		<div th:if="${hechos == null || hechos.isEmpty()}" class="text-center text-gray-500 py-4 text-sm">
			<!-- Ajustado tamaño de fuente -->
			No hay hechos recientes
		</div>
	</div>
</div>

<div th:fragment="modalFiltros" id="filtros-modal" class="panel">
	<div class="flex justify-between items-center p-4 pb-3">
		<h3 class="text-lg font-bold">Filtros</h3>
		<div class="flex items-center gap-2.5">
			<button id="btn-aplicar-filtros" class="btn-secondary" aria-label="Aplicar Filtros">
				Aplicar
			</button>
			<button id="btn-toggle-filtros" class="text-gray-600 hover:text-gray-900 focus:outline-none transition-transform duration-200" aria-label="Cerrar o Abrir Panel de Filtros">
				<svg id="chevron-filtros-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
					 stroke-width="2" stroke="currentColor" class="w-6 h-6">
					<path stroke-linecap="round" stroke-linejoin="round" d="M19.5 8.25l-7.5 7.5-7.5-7.5"/>
				</svg>
			</button>
		</div>
	</div>
	<hr id="filtros-separator" class="mb-4">

	<div id="filtros-content" class="px-4 pb-4">
		<form id="form-filtros">
			<!-- Categoría -->
			<div class="mb-4">
				<label for="categoria" class="block text-xs font-medium text-gray-700 mb-1">
					Categoría
					<span class="max-char-span">
						(Máx.50 caracteres)
					</span>
				</label>
				<input type="text"
					   id="categoria"
					   name="categoria"
					   maxlength="50"
					   th:value="${categoria}"
					   class="w-full px-2 py-1.5 text-xs border border-gray-300 rounded-full focus:ring-2 focus:ring-gray-300 focus:border-transparent outline-none"
					   placeholder="Ingrese categoría...">
			</div>

			<!-- Fecha reporte -->
			<div class="mb-4">
				<label class="block text-xs font-medium text-gray-700 mb-1">Fecha reporte</label>
				<div class="flex flex-col gap-1">
					<div class="flex gap-1 items-center">
						<p class="text-xs font-light w-[36px]">Desde</p>
						<input type="datetime-local" id="fechaReporteDesde" name="fechaReporteDesde"
							   th:value="${fechaReporteDesde}"
							   class="w-full px-2 py-1 text-xs border border-gray-300 rounded-lg focus:ring-2 focus:ring-gray-300 focus:border-transparent outline-none">
					</div>
					<div class="flex gap-1 items-center">
						<p class="text-xs font-light w-[36px]">Hasta</p>
						<input type="datetime-local" id="fechaReporteHasta" name="fechaReporteHasta"
							   th:value="${fechaReporteHasta}"
							   class="w-full px-2 py-1 text-xs border border-gray-300 rounded-lg focus:ring-2 focus:ring-gray-300 focus:border-transparent outline-none">
					</div>
				</div>
			</div>

			<!-- Fecha acontecimiento -->
			<div class="mb-4">
				<label class="block text-xs font-medium text-gray-700 mb-1">Fecha acontecimiento</label>
				<div class="flex flex-col gap-1">

					<div class="flex gap-1 items-center">
						<p class="text-xs font-light w-[36px]">Desde</p>
						<input type="datetime-local"
							   id="fechaAcontecimientoDesde"
							   name="fechaAcontecimientoDesde"
							   th:value="${fechaAcontecimientoDesde}"
							   class="w-full px-2 py-1 text-xs border border-gray-300 rounded-lg focus:ring-2 focus:ring-gray-300 focus:border-transparent outline-none">
					</div>
					<div class="flex gap-1 items-center">
						<p class="text-xs font-light w-[36px]">Hasta</p>
						<input type="datetime-local"
							   id="fechaAcontecimientoHasta"
							   name="fechaAcontecimientoHasta"
							   th:value="${fechaAcontecimientoHasta}"
							   class="w-full px-2 py-1 text-xs border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent outline-none">
					</div>
				</div>
			</div>

			<!-- Ubicación -->
			<div class="mb-4">
				<label class="block text-xs font-medium text-gray-700 mb-1">Ubicación (haz clic en el mapa)</label>
				<div class="grid grid-cols-2 gap-2 mb-2">
					<div>
						<label for="filtroLatitud" class="block text-xs font-light text-gray-600 mb-1">Latitud</label>
						<input type="number" step="any" id="filtroLatitud" name="latitud"
							   class="w-full px-2 py-1 text-xs border border-gray-300 rounded-lg"
							   placeholder="-34.603722" readonly>
					</div>
					<div>
						<label for="filtroLongitud" class="block text-xs font-light text-gray-600 mb-1">Longitud</label>
						<input type="number" step="any" id="filtroLongitud" name="longitud"
							   class="w-full px-2 py-1 text-xs border border-gray-300 rounded-lg"
							   placeholder="-58.381592" readonly>
					</div>
				</div>
				<div>
					<label for="filtroRadio" class="block text-xs font-light text-gray-600 mb-1">
						Radio: <span id="radio-value">5</span> km
					</label>
					<input type="range" id="filtroRadio" name="radio" min="1" max="100" value="5" step="1"
						   class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer">
				</div>
			</div>

			<!-- Botón limpiar filtros -->
			<button type="button"
					id="btn-limpiar-filtros"
					class="w-full mt-2 px-3 py-1.5 text-xs text-gray-600 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors"
					aria-label="Limpiar Filtros">
				Limpiar filtros
			</button>
		</form>
	</div>
</div>

<div th:fragment="modalHechosPendientes" id="detalleModal" class="modal hidden">
	<div class="modal-content modal-pendientes-content">
		<button class="modal-close" onclick="closeDetalle()">×</button>
		<h2 id="modalTitulo"></h2>
		<p id="modalDescripcion"></p>
		<div class="modal-meta">
			<div><strong>Fecha:</strong> <span id="modalFecha"></span></div>
			<div><strong>Ubicación:</strong> <span id="modalUbicacion"></span></div>
			<div><strong>Autor:</strong> <span id="modalAutor"></span></div>
		</div>

		<div class="gestion">
			<label for="sugerencia">Sugerencia / Observación</label>
			<textarea id="sugerencia" rows="3" placeholder="Opcional..."></textarea>

			<div class="gestion-buttons">
				<button id="aceptarBtn" class="btn-aceptar" onclick="gestionar('ACEPTADO')">Aceptar</button>
				<button id="rechazarBtn" class="btn-rechazar" onclick="gestionar('RECHAZADO')">Rechazar</button>
			</div>
		</div>
	</div>
</div>

<div th:fragment="modalSolicitudEliminacion" id="modal-solicitud-eliminacion" class="modal-page hidden">
	<div class="modal-content custom-modal-solicitud modal-page-format max-w-2xl">
		<div class="modal-solicitud-header">
			<h5 class="modal-solicitud-title text-white">Usted va a solicitar la eliminación de este hecho</h5>
		</div>
		<div class="modal-solicitud-body">
			<form id="formSolicitud" class="mb-3">
				<label for="motivo-solicitud-eliminacion" class="form-label text-xl">
					Motivo
					<span class="max-char-span text-xs">
						(Mín.500 caracteres)
						(Máx.2000 caracteres)
					</span>
				</label>
				<textarea class="form-solicitud-control" maxlength="2000" minlength="500" id="motivo-solicitud-eliminacion" rows="3" placeholder="Ingrese el motivo de la solicitud..." required></textarea>
			</form>
		</div>
		<div class="modal-solicitud-footer">
			<th:block th:replace="~{fragments/button :: exitModalButton('Cancelar', 'salir-solicitar-eliminacion')}" />
			<th:block th:replace="~{fragments/button :: spinnerConfirmButton('Enviar', 'enviar-solicitud-eliminacion')}" />
		</div>
	</div>
</div>