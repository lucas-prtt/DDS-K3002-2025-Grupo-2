<!DOCTYPE html>

<html lang="es" xmlns:th="http://www.thymeleaf.org" th:fragment="layout(contenido, isMapPage)">
    <head>
        <title>MetaMapa</title>
        <link rel="icon" type="image/x-icon" th:href="@{/favicon.ico}">

        <!-- Metas -->
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name="_csrf" th:content="${_csrf?.token}" />
        <meta name="_csrf_header" th:content="${_csrf?.headerName}" />

        <!-- Bootstrap & Tailwind -->
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
        <script src="https://cdn.tailwindcss.com"></script>

        <!-- Google Fonts -->
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@400;500;700&display=swap" rel="stylesheet">

        <!-- Custom CSS -->
        <link rel="stylesheet" href="/css/metamapa.css">
        <link rel="stylesheet" href="/css/menu.css">
        <link rel="stylesheet" href="/css/modal.css">
        <link rel="stylesheet" href="/css/form.css">
        <link rel="stylesheet" href="/css/button.css">
        <link rel="stylesheet" type="text/css" href="/css/pagination.css" />
    </head>
    <body class="font-roboto bg-gray-50 min-h-screen">
        <!-- Header -->
        <th:block th:replace="~{fragments/header :: navbar(${isMapPage})}" />

        <!-- Main -->
        <th:block th:replace="${contenido}" />

        <!-- Footer -->
        <th:block th:replace="~{fragments/footer :: footer}" />

        <!-- Scripts -->
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.min.js"></script>
        <th:block th:replace="~{fragments/header :: headerScripts}" />
        <script src="/js/listen-event.js" defer></script>
        <script src="/js/spinner.js" defer></script>
        <script src="/js/modal.js" defer></script>
        <script src="/js/get-payload.js" defer></script>
        <script>
            function getHeaders() {
                const csrfHeaderName = document.querySelector('meta[name="_csrf_header"]')?.getAttribute('content');
                const csrfToken = document.querySelector('meta[name="_csrf"]')?.getAttribute('content');

                if (!csrfHeaderName || !csrfToken) {
                    console.error('CSRF tokens no encontrados');
                }

                return  {
                    'Content-Type': 'application/json',
                    [csrfHeaderName]: csrfToken
                }
            }
        </script>

        <!-- Agregar antes del cierre del body -->
        <script th:inline="javascript">
            /*<![CDATA[*/
            window.autorData = {
                id: [[${userId}]],
                email: [[${email}]],
                nombre: [[${firstName}]],
                apellido: [[${lastName}]],
                fechaNacimiento: [[${birthDate}]]
            };

            const isAdmin = /*[[${isAdmin}]]*/ {};
            const jwtToken = /*[[${JWT_Token}]]*/ {};
            const apiPublicaUrl = /*[[${apiPublicaUrl}]]*/ {};
            const apiAdministrativaUrl = /*[[${apiAdministrativaUrl}]]*/ {};
            /*]]>*/
        </script>
    </body>
</html>