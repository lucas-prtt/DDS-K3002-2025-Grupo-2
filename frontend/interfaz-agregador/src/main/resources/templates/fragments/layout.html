<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org" th:fragment="layout(contenido, isMapPage)">
    <head>
        <title>MetaMapa</title>
        <link rel="icon" type="image/x-icon" th:href="@{/favicon.ico}">

        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <!-- Tokens CSRF para formularios POST -->
        <meta name="_csrf" th:content="${_csrf?.token}" />
        <meta name="_csrf_header" th:content="${_csrf?.headerName}" />

        <!-- Tailwind CSS desde CDN -->
        <script src="https://cdn.tailwindcss.com"></script>

        <!-- Bootstrap CSS -->
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

        <!-- Google Fonts -->
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@400;500;700&display=swap" rel="stylesheet">

        <link rel="stylesheet" href="/css/metamapa.css">

        <!-- ============================================== -->
        <!-- INCLUYE LOS ESTILOS ESPECÍFICOS DE LA PÁGINA   -->
        <!-- (Solo si el fragmento 'pageStyles' está definido) -->
        <th:block th:replace="~{::pageStyles}" />
        <!-- ============================================== -->
        <link rel="stylesheet" href="/css/menu.css">
        <link rel="stylesheet" href="/css/button.css">
        <link rel="stylesheet" href="/css/form.css">
        <link rel="stylesheet" href="/css/modal.css">
    </head>

    <body class="font-roboto bg-gray-50 min-h-screen">

        <!-- Header -->
        <th:block th:replace="~{fragments/header :: navbar(${isMapPage})}" />

        <!-- Contenido Principal (variable) -->
        <th:block th:replace="${contenido}" />

        <!-- Footer -->
        <th:block th:replace="~{fragments/footer :: footer}" />

        <!-- Scripts -->
        <th:block th:replace="~{::pageScripts}" />
        <th:block th:replace="~{fragments/menu :: menuScripts}" />
        <script src="/js/listen-event.js" defer></script>
        <script>
            function getHeaders() {
                const csrfHeaderName = document.querySelector('meta[name="_csrf_header"]')?.getAttribute('content');
                const csrfToken = document.querySelector('meta[name="_csrf"]')?.getAttribute('content');

                if (!csrfHeaderName || !csrfToken) {
                    console.error('CSRF tokens no encontrados');
                }

                return  {
                    'Content-Type': 'application/json',
                    [csrfHeaderName]: csrfToken
                }
            }
        </script>

        <!-- Bootstrap JS -->
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

        <!-- Agregar antes del cierre del body -->
        <script th:inline="javascript">
            /*<![CDATA[*/
            window.autorData = {
                id: [[${userId}]],
                email: [[${email}]],
                nombre: [[${firstName}]],
                apellido: [[${lastName}]]
            };
            console.log('Datos del autor:', window.autorData);
            /*]]>*/
        </script>
    </body>
</html>
