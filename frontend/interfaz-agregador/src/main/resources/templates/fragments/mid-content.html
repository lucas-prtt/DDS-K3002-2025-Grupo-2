<div th:fragment="mapa(hechos)">
    <!-- Leaflet CSS y JS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

    <style>
        #map { height: 500px; width: 100%; margin-top: 1rem; }
    </style>

    <div id="map"></div>

    <script th:inline="javascript">
        /*<![CDATA[*/
        var hechosJson = /*[[${hechos}]]*/ '[]';
        var hechos = typeof hechosJson === 'string' ? JSON.parse(hechosJson) : hechosJson;

        console.log("Hechos en JS:", hechos); // Para verificar que llegan correctamente

        // Inicializamos el mapa centrado en Buenos Aires
        const map = L.map('map').setView([-34.6037, -58.3816], 12);

        // Capa de mapa de OpenStreetMap
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: 'Â© OpenStreetMap contributors',
            noWrap: true
        }).addTo(map);

        // Icono personalizado con color #4f46e5
        const customIcon = L.icon({
            iconUrl: 'data:image/svg+xml;base64,' + btoa(`
                <svg xmlns="http://www.w3.org/2000/svg" width="25" height="41" viewBox="0 0 25 41">
                    <path fill="#4f46e5" stroke="#ffffff" stroke-width="1.5" d="M12.5 0C5.596 0 0 5.596 0 12.5c0 1.933.439 3.761 1.217 5.394L12.5 41l11.283-23.106A12.42 12.42 0 0 0 25 12.5C25 5.596 19.404 0 12.5 0z"/>
                    <circle fill="#ffffff" cx="12.5" cy="12.5" r="5"/>
                </svg>
            `),
            iconSize: [25, 41],
            iconAnchor: [12, 41],
            popupAnchor: [0, -41]
        });

        // Agregamos un marker por cada hecho
        hechos.forEach(h => {
            if (h.ubicacion && h.ubicacion.latitud && h.ubicacion.longitud) {
                const popupContent = `
                    <div style="text-align: center;">
                        <b>${h.titulo}</b>
                        <br><br>
                        <a href="/hechos/${h.id}"
                           style="display: inline-block; padding: 8px 16px; background-color: #4f46e5; color: white; text-decoration: none; border-radius: 4px; font-weight: 500;">
                           Ver hecho
                        </a>
                    </div>
                `;
                L.marker([h.ubicacion.latitud, h.ubicacion.longitud], {icon: customIcon})
                    .addTo(map)
                    .bindPopup(popupContent);
            }
        });
        /*]]>*/
    </script>
</div>

<div th:fragment="hechosRecientes">

</div>

<div th:fragment="filtros">

</div>