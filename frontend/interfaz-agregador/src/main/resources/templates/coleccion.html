<th:block th:fragment="pageScripts">
    <script th:unless="${!isAdmin}" src="/js/editar-coleccion.js" defer></script>
</th:block>

<th:block th:fragment="pageStyles" />



<th:block th:unless="${!isAdmin}" th:replace="~{fragments/layout :: layout(~{::main}, false)}">
    <main class="main-padding flex justify-center">
        <div class="card w-[55rem] p-6">
            <div class="mb-6 pb-3 border-b">
                <h1 class="text-3xl font-bold" th:text="${coleccion.titulo}"></h1>
                <p class="text-md text-gray-600 mt-1" th:text="${coleccion.descripcion}"></p>
            </div>

            <!-- 1) Cambiar algoritmo -->
            <section class="form-container">
                <label for="coleccion-algoritmo-select" class="form-container-title">
                    Algoritmo de Consenso: <span th:text="${coleccion.tipoAlgoritmoConsenso}"></span>
                </label>
                <div class="flex items-center gap-3 justify-between">
                    <select id="coleccion-algoritmo-select" class="form-control w-[60%]">
                        <option value="ABSOLUTO">Absoluto</option>
                        <option value="IRRESTRICTO">Irrestricto</option>
                        <option value="MAYORIA_SIMPLE">Mayoría simple</option>
                        <option value="MULTIPLES_MENCIONES">Múltiples menciones</option>
                    </select>
                    <!-- Usar data-attribute en lugar de th:onclick para evitar la restricción de Thymeleaf -->
                    <div th:replace="~{fragments/button :: spinnerConfirmButton('Guardar Cambio', 'cambiar-algoritmo-coleccion')}" th:data-coleccion-id="${coleccion.id}" class="w-auto"></div>
                </div>
            </section>

            <!-- 2) Listado de fuentes con eliminar -->
            <section class="form-container">
                <h2 class="form-container-title">Fuentes Actuales</h2>
                <ul th:if="${not #lists.isEmpty(coleccion.fuentes)}" class="space-y-2">
                    <li th:each="f : ${coleccion.fuentes}" class="flex items-center justify-between p-2 bg-white border rounded-md shadow-sm">
                        <div class="text-sm">
                            <strong class="text-gray-900" th:text="${f.id}">ID_FUENTE_EJEMPLO</strong>
                            <span class="text-gray-600" th:if="${f.ip}"> — IP: <span class="font-mono" th:text="${f.ip}">127.0.0.1</span></span>
                            <span class="text-gray-600" th:if="${f.puerto}"> — Puerto: <span class="font-mono" th:text="${f.puerto}">8080</span></span>
                        </div>

                        <button type="button" class="btn-danger-small btn-eliminar-fuente"
                                th:id="coleccion-eliminar-fuente-${f.id}"
                                th:data-coleccion-id="${coleccion.id}"
                                th:data-fuente-id="${f.id}"
                                aria-label="Eliminar Fuente">
                            ✕ Eliminar
                        </button>
                    </li>
                </ul>
                <p th:if="${#lists.isEmpty(coleccion.fuentes)}" class="text-sm text-gray-500 italic">Esta colección no tiene fuentes asignadas.</p>
            </section>

            <!-- 3) Agregar fuente -->
            <section class="form-container">
                <h3 class="form-container-title">Agregar Nueva Fuente</h3>
                <div class="flex items-end justify-between">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-3 items-end w-[79%]">
                        <div>
                            <label for="newFuenteTipo" class="block text-xs font-medium text-gray-700 mb-1">Tipo <span class="text-red-500">*</span></label>
                            <select id="newFuenteTipo" class="form-control">
                                <option value="ESTATICA">Estática</option>
                                <option value="DINAMICA">Dinámica</option>
                                <option value="PROXY">Proxy</option>
                            </select>
                        </div>
                        <div>
                            <label for="newFuenteId" class="block text-xs font-medium text-gray-700 mb-1">ID Fuente <span class="text-red-500">*</span></label>
                            <input id="newFuenteId" maxlength="255" type="text" placeholder="ID único de la fuente" class="form-control bg-white" />
                        </div>
                    </div>
                    <button id="btnAgregarFuente" type="button" class="btn-confirmar h-[42px]" th:data-coleccion-id="${coleccion.id}" aria-label="Agregar Fuente">
                        Agregar Fuente
                    </button>
                </div>
            </section>

            <section class="mt-8 flex justify-start">
                <a th:href="@{/colecciones}" class="btn-cancelar" aria-label="Salir de Editar Colección">← Volver al Listado</a>
            </section>
        </div>
    </main>
</th:block>